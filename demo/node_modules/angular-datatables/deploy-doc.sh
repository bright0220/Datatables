#!/bin/bash

function debug {
  echo "[-] $1"
}

cwd=$(pwd)
project_name=${PWD##*/}

debug "Deloying the documentation to the GH pages from $cwd (project name is $project_name)"

debug "Building documentation..."
cd $cwd/demo
ng build -prod --base-href /angular-datatables/

debug "Copying the doc folder to /tmp"
rm -rf /tmp/angular-datatables-demo
cp -r dist /tmp/angular-datatables-demo
cd /tmp/angular-datatables-demo

debug "Copying project to /tmp and switch to gh-pages branch"
rm -rf /tmp/$project_name
cp -r $cwd /tmp
cd /tmp/$project_name
git add -A && git stash
git checkout gh-pages

debug "Remove all files except .git"
find . -maxdepth 1 | grep -v ".git" | xargs rm -rf

debug "Copy the doc to the gh-pages branch"
cp -r /tmp/angular-datatables-demo/* /tmp/$project_name

debug "Commit gh-pages"
git add -A && git commit -m "Deploy documentation to gh-pages"

debug "Pushing to remote"
git push -u origin gh-pages

exit 0
